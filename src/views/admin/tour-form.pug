extends ../../base

block head
  title #{title} | Natours Admin
  link(rel='stylesheet' href='/css/admin.css')

block content
  .admin-container
    // Admin Sidebar
    aside.admin-sidebar
      .admin-sidebar__header
        .admin-sidebar__logo
          img(src='/img/logo-green.png' alt='Natours Admin')
        h2.admin-sidebar__title Admin Panel
        
      nav.admin-sidebar__nav
        ul.admin-sidebar__menu
          li.admin-sidebar__item
            a.admin-sidebar__link(href='/admin/dashboard' data-section='dashboard')
              svg.admin-sidebar__icon
                use(xlink:href='/img/icons.svg#icon-map')
              span Dashboard
          li.admin-sidebar__item
            a.admin-sidebar__link.admin-sidebar__link--active(href='/admin/tours' data-section='tours')
              svg.admin-sidebar__icon
                use(xlink:href='/img/icons.svg#icon-map')
              span Tours
          li.admin-sidebar__item
            a.admin-sidebar__link(href='/admin/users' data-section='users')
              svg.admin-sidebar__icon
                use(xlink:href='/img/icons.svg#icon-user')
              span Users
          li.admin-sidebar__item
            a.admin-sidebar__link(href='/admin/bookings' data-section='bookings')
              svg.admin-sidebar__icon
                use(xlink:href='/img/icons.svg#icon-credit-card')
              span Bookings
          li.admin-sidebar__item
            a.admin-sidebar__link(href='/admin/reviews' data-section='reviews')
              svg.admin-sidebar__icon
                use(xlink:href='/img/icons.svg#icon-star')
              span Reviews

    // Main Content Area
    main.admin-main
      // Top Header
      header.admin-header
        .admin-header__left
          h1.admin-header__title #{title}
          p.admin-sidebar__subtitle #{tour ? 'Edit existing tour' : 'Create a new tour'}
        .admin-header__right
          .admin-header__user
            img.admin-header__user-img(src=`/img/users/${user.photo || 'default.jpeg'}` alt=`${user.name}`)
            span.admin-header__user-name= user.name
          .admin-header__actions
            a.btn.btn--white.btn--small(href='/admin/tours') Back to Tours
            a.btn.btn--green.btn--small(href='/') View Site

      // Tour Form Content
      .admin-content
        .admin-form-container
          form.admin-form#tourForm
            .admin-form__row
              .admin-form__group
                label.admin-form__label(for='name') Tour Name
                input.admin-form__input#name(type='text' name='name' value=tour ? tour.name : '' required)
              
              .admin-form__group
                label.admin-form__label(for='price') Price
                input.admin-form__input#price(type='number' name='price' value=tour ? tour.price : '' required)
            
            .admin-form__row
              .admin-form__group
                label.admin-form__label(for='duration') Duration (days)
                input.admin-form__input#duration(type='number' name='duration' value=tour ? tour.duration : '' required)
              
              .admin-form__group
                label.admin-form__label(for='maxGroupSize') Max Group Size
                input.admin-form__input#maxGroupSize(type='number' name='maxGroupSize' value=tour ? tour.maxGroupSize : '' required)
            
            .admin-form__row
              .admin-form__group
                label.admin-form__label(for='difficulty') Difficulty
                select.admin-form__input#difficulty(name='difficulty' required)
                  option(value='' selected=tour && tour.difficulty === '') Select Difficulty
                  option(value='easy' selected=tour && tour.difficulty === 'easy') Easy
                  option(value='medium' selected=tour && tour.difficulty === 'medium') Medium
                  option(value='difficult' selected=tour && tour.difficulty === 'difficult') Difficult
              
              .admin-form__group
                label.admin-form__label(for='startLocation') Start Location
                input.admin-form__input#startLocation(type='text' name='startLocation' value=tour ? tour.startLocation : '' required)
            
            .admin-form__group
              label.admin-form__label(for='description') Description
              textarea.admin-form__textarea#description(name='description' rows='4' required)= tour ? tour.description : ''
            
            .admin-form__group
              label.admin-form__label(for='summary') Summary
              textarea.admin-form__textarea#summary(name='summary' rows='3' required)= tour ? tour.summary : ''
            
            .admin-form__group
              label.admin-form__label(for='imageCover') Cover Image URL
              input.admin-form__input#imageCover(type='url' name='imageCover' value=tour ? tour.imageCover : '' required)
            
            .admin-form__group
              label.admin-form__label(for='images') Additional Images (comma-separated URLs)
              input.admin-form__input#images(type='text' name='images' value=tour && tour.images ? tour.images.join(', ') : '')
            
            .admin-form__group
              label.admin-form__label(for='startDates') Start Dates (comma-separated)
              input.admin-form__input#startDates(type='text' name='startDates' value=tour && tour.startDates ? tour.startDates.join(', ') : '')
            
            .admin-form__group
              label.admin-form__label(for='guides') Guide IDs (comma-separated)
              input.admin-form__input#guides(type='text' name='guides' value=tour && tour.guides ? tour.guides.join(', ') : '')
            
            .admin-form__group
              label.admin-form__label(for='locations') Locations (JSON format)
              textarea.admin-form__textarea#locations(name='locations' rows='3')= tour && tour.locations ? JSON.stringify(tour.locations, null, 2) : ''
            
            .admin-form__actions
              button.btn.btn--green.btn--small(type='submit') #{tour ? 'Update Tour' : 'Create Tour'}
              a.btn.btn--white.btn--small(href='/admin/tours') Cancel

    // Loading Overlay
    .admin-loading#adminLoading
      .admin-loading__spinner
        svg
          use(xlink:href='/img/icons.svg#icon-loader')

block scripts
  script(src='/js/admin-tours.js')
